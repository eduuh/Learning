- Learn web server and DNS configuration and management for Red Hat Enterprise Linux (RHEL)â€”one of the most popular Linux distributions. Instructor Grant McWilliams shows how to configure a caching-only web server using BIND, the open-source DNS software, and set up and secure an Apache web server. Then he shows how to use basic authentication to create a password-protected website and a private site for group collaboration. Next, learn how to create standard virtual hosts as well as those using nonstandard ports, and secure hosts with SSL and TLS. Finally, get an introduction to NGINX, the open-source web server that's taken world by storm, and find out how to create virtual hosts with this popular Apache alternative.

- Installing DNS clients
- Using host, nslookup, and dig
- Name resolution
- DNS roles
- Configuring DNS
- Apache web server features
- Apache commands and access control
- Configure Apache and virtual hosts
- Securing virtual hosts with SSL and TLS
- Running CGI scripts in Apache
- Configuring NGINX server blocks# Lab setup

### Lab Setup

- ## [Instructor] In order to configure in test Lynx ISCZ storage area networks using virtual files, we need more than one virtual machine. We'll need need two VMs and we want to have both VMs and we want to have both VMs to be able to access each others network interfaces. We may also want to have the virtual box host or other computers on the physical network to have a network connectivity with the VM guest. In order to do this, we'll need to configure the VM network interfaces. In order to clone your VM, you need to make sure that it is shut down. If your VM is running, shut it down now using the Virtual Box Manager. Once its shut down, you can continue. To configure the network settings, click on VM and then click on settings and then network. Change attached to NAT to attached to Bridged Adapter. In the name section, make sure you select the physical network adaptor of your host machine that has access to the internet. In my case, the host is running a lynx and I'm using the wired network adaptor so I'm going to choose enp0s25, which is the name that my lynx host installation has chosen for it. If you're using MacOS or Windows, choose the appropriate network interface that your host is using. Once that's done, click on okay. We also need to discard the saved space so our VMs boot up fresh for the first time. If you don't do this, then all your VMs will boot up and assume the same IP address because that is a live setting in RAM which is included in the saved state. Make sure your VM is selected and then click on discard. Click on discard again. Once we have our VM network adapter configured, we want to clone the VM. In the virtual box manager window, go to the machine menu and select clone and a dialogue box asking for the VM name should appear. Let's call it rhhost1. Also click the box to reinitialize the MAC addresses of all network cards. This is so all network cards have unique MAC addresses so even though the rest of the VM is identical, the MAC addresses won't be. Now we have to choose the type of clone we want. A full clone makes a completely independent VM that can be moved without the original but also takes up an equal amount of disc space as the original. If you foresee moving one VM without the other, you may want to choose full clone here. However, for our purposes, making a linked clone is perfectly fine and uses less disc space. I'm going to choose linked clone. Now click on clone. Now let's click on the original VM again and create a second linked clone. Select machine and then clone. Let's name this one rhhost2. Click on linked clone and reinitialize the MAC address of all network cards. And then click on clone. Now we should have two virtual machines named rhhost1 and rhhost2.

## Install Guest Additions

- [Instructor] VirtualBox Guest Additions are pieces of software installed in the guest operating system that gives the OS a direct communication path to VirtualBox. This allows the guest to take advantage of faster drivers, better screen resolutions, and better integration between the guest and the host. I highly recommend installing Guest Additions as it makes the virtual experience smoother. When running a VM, you may notice if you press Host + F to go into full screen mode, that CentOS doesn't fill the entire screen. Installing Guest Additions will fix this, among other things. There are a few prerequisites for installing VirtualBox Guest Additions. All CentOS system updates have to be done and the VM has to be rebooted to ensure CentOS is using the latest kernel. Also, the network needs to be functional. To update the system software, open a terminal in your VM by selecting Applications, Favorites, and Terminal. I'm gonna make mine fullsceen and I'm gonna bump my font size. Now type in sudo yum -y update and hit Enter and then type in your password. There's a chance that the yum database may be currently locked. If so, you need to kill the other yum process, which is listed in the error output. In this case, you'd type in sudo kill -9 and the process ID listed in the error output and then you'd run the yum update command again. In my case, the update is going well and I only have one package to update, which is the kernel. When the updates are done, reboot by typing in sudo reboot and hit Enter. Type in your password. Once the VM has rebooted, log back in and open a terminal. Now let's install the development tools software group by typing sudo yum group install -y - -setopt=group_command=objects "Development Tools" and hit Enter. Type in your password and hit Enter again. Due to a change in the way software groups are handled in CentOS 7, we need to add the --setup option listed above. In your case, it may work without it. We need the double quotes so yum knows we're installing one software group called Development Tools. When that's done, we'll need to install the kernel source. Type in sudo yum install -y kernel-devel and hit Enter. After yum is finished installing the kernel source, we can close the terminal window. Now let's go to the virtual machine menus. If you're in fullscreen mode like I am, then you'll need to press the Host key to release your mouse pointer and then hover it over the bottom of the screen. The menu bar should show up. If you're not in fullscreen mode, you'll need to press your Host key and then click on the menu at the top of the window. Select Devices and Insert Guest Additions CD Image. Once the dialog pops up, click on Run and type in your password. Once we've authenticated, it will start installing Guest Additions. The installer is taking the development tool software and is compiling a module for the Linux kernel and then installing it, which should finish in a few moments. Now that the Guest Additions software is installed, reboot your VM again by going to the top right-hand menu and selecting the power button and then click Restart. Once it has rebooted, log in and you should be able to go into actual fullscreen mode by pressing Host key + F. If your VM rebooted okay and your Guest Additions installed successfully, you'll want to create a new snapshot. With our VM running, press Host + T to create a new snapshot. We'll call this snapshot Guest Additions. And hit Enter. You will want to follow the same procedure for each of your virtual machines.

### configure resolv.conf

[Narrator] There are two client-side name resolution files that we should be concerned with in Enterprise Linux 7, resolv.conf and nsswitch.conf. The purpose of resolv.conf is to provide a list of global DNS service for our client to query when resolving DNS names. The format of the file is fairly simple. There are two columns. The first column will have either search, domain, nameserver, sortlist, or option in it. If it is search, it will be followed by up to six domain names with a total of 256 characters that will be appended if you try to resolve something incomplete. For instance, if you tried resolving the word test and the search line included localnet.com, ford.com, and apple.com, it would try to resolve test.localnet.com, test.ford.com, test.apple.com, and, lastly, test by itself. One of these domains has to be a local domain name. If you do not include a search line, then it defaults to your local domain name. For instance, if my local domain name was localnet.com and I tried resolving test, my system would resolve test.localnet.com, first, and then try to resolve test, second, even if I did not have a search line. If the first column specifies domain, it will append that domain to the end of a short name. Normally this is our local domain name, but if we wanted to change it we could. For instance, if we had domain, space, otherdomain.com and we resolved test, it would try to resolve it to test.otherdomain.com. You only need to do this if your local domain is not the same as the rest of your network. The keyword we use the most is nameserver. The nameserver keyword is followed by a DNS server IP address to query. For instance, nameserver, space, 4.2.2.2. You can have up to three nameserver lines and the client will query them in the order they're listed. The sortlist keyword allows us to sort IP addresses in certain networks. For instance, if we had sortlist, space, 130.155.160.0, slash, 255.255.240.0, it would allow addresses returned to be sorted in this network. There can be up to 10 network and subnet pairs. The last keyword in the first column is options. The options keyword lets us set DNS client options such as querying the nameservers round robin to spread the load, a timeout, or the number of attempts the client will query the DNS server before giving up. Keep in mind, too, that if you want to set DNS nameservers per network interface, you can do so by adding them to the interface specific network configuration files. The /etc/resolve.conf is a global configuration file. Also, keep in mind that if you set your DNS servers an interface specific configuration file, and you also set the pure DNS director to yes, then those DNS servers will get copied to /etc/resolve.conf automatically.

### nsswitch Database Names.

- [Instructor] The name service switch, or nsswitch file, is used by applications to determine sources to get name service information from. This isn't just for domain name resolution order, but rather for multiple categories. Each category of information is identified by a database name. The first column of the file is the database name. Then remaining columns specify the order in which to look up the data. The following databases are understood: aliases for mail aliases, ethers for ethernet numbers, group for groups of users, host for host names and numbers, initgroup for supplementary group lists, netgroup for network groups, networks for network names and numbers, password for passwords, protocols for network protocols, public key for secret keys used by NFS and NIS+, rpc for remote procedure call numbers, services for network services and lastly shadow for shadow passwords. For this course we're mainly interested in the host keyword. Possible options would be files, DNS, NIS, NIS+. The latter two would use suns NIS or NIS+ for hosting resolution. The first two would be for more common situations. The finals option specifies to resolve host names used in the local name resolution file, etc host. DNS would instruct the client to resolve via DNS. We can use both and it will try them in order left to right. For instance, it's common to use host, colon, space, files, space, DNS. This way it will consult the etc host file first and then try to resolve with DNS second. This allows us to override DNS with a local etc host entry. After each option we can have an optional status and an action inside square brackets. This status can be one of success where no error occurred, not found where the lookup succeeded, but the entry was not found, unavail where the service is permanently unavailable, or try again where the service is temporarily unavailable. This could mean that the file is locked or the server can't process what's been request, it's temporary. The action can be one of return, which returns the result right away, continue which moves onto the next method in the list, or merge which allows the system to move onto the next method after finding a result and then merges the results. We can use an exclamation mark to negate the status to match anything, but what is in the square brackets. In our example earlier it would return if DNS was not unavailable, which is the same thing as being available and then not move onto resolving via the etc host file.

### Install DNS clients

To install the client tools we'll need to log into our rhhost1 VM and open a terminal. I'm going to install the bind-utils package. It may already be installed but we'll wanna make sure. In a terminal type in sudo yum install -y bind-utils and hit enter. Type in your password if prompted. Let's take a look at what's inside the bind-utils package. Type in clear and then type in rpm -ql bind-utils and hit enter. We can see that we have a few commands including dig, host, nslookup, and nsupdate. This'll be perfect for this chapter. Now let's log into rhhost2 and do the same. In a terminal type in sudo yum install -y bind-utils and hit enter and type in your password if prompted.

### Use host and nslookup.

- [Instructor] Two tools that are included in the bind-utils package are host and nslookup. Both tools provide name resolution but are quite different. In rhhost1, log in and open a Terminal. In the Terminal, type in host google.com and hit Enter. We can see that it resolves google.com. Host is a simple tool that is useful when you just need to resolve a host name quickly. There are a few options that can be specified, but it's nowhere near as powerful as dig or nslookup. The other tool we can look at is nslookup. Nslookup is the legacy name resolution tool that uses its own resolver code as opposed to dig, which uses the operating systems. For years, nslookup came with a warning that said it was going to go away, but with the most recent versions of BIND, it seems to have been elevated back to full status. Type in clear, and then type in nslookup google.com, and hit Enter. Some things are easier when using nslookup than when using dig. And it may be more familiar to users of other operating systems. However, I find myself using host for simple resolution tasks, and dig for more complex ones. Nslookup gets lost in the middle somewhere. If you want to know more about nslookup, type
-
-
- ### Use dig

- We have more than one command and query DNS servers, including the legacy NS Lookup. However, Dig does such a good job, I'm gonna focus on it. Let's type in "dig space red hat dot com" and look at the results. In a terminal type "dig space red hat dot com" and hit enter. This shows information on red hat dot com. The dig command shows the header, which includes the dig command version number and the global options used by Dig. It also shows a question section which is the question it sent to the DNS server. Since the default question is an address query, it shows that we made an address query. Then comes the answer section which is the response from the DNS query. In our case it shows the address record. Next is the authority section, which displays the DNS name server that has the authority to respond to this query. Lastly is the additional section which displays the IP address of the name server listed in the authority section, followed by stats about the query including the amount of time it took. If we want to pare this down and only show the answers section, we have to add some options. Type in "clear" and then type in "dig space red hat dot com space plus no comment space plus no question space plus no authority space plus no additional space plus no stats" and hit enter. You can of course choose to hide any of these individually if you wish. An interesting shortcut is to turn off all sections, and then turn the answer section back on. Type in "dig space red hat dot com space plus no all space plus answer" This is a shorter line to type but provides the same output as the long line we typed in previously. By default, dig queries the address record but we can select a different record if we wish. To do this, filter by the record type. For instance, to ask for the mail exchange record, let's type in "clear" and then type in "dig space red hat dot com space capital MX space plus no all space plus answer" and hit enter. If you want the name server address just replace the "MX" with "NS" for name server. To view all records, replace "MX" with "any". We'll bring our line back by pressing the up arrow key and then replace "MX" with the word "any" and hit enter. If you just want the IP addresses which might be useful in the cases of shell-strips, you can use the plus short option. Type in "clear" and then type in "dig space red hat dot com space plus short" and hit enter. This can be combined with any of the record filters we just discussed. A reverse DNS look-up takes the IP address, and finds the DNS name associated with it. We'll need to use the dash X option to do a reverse look-up. We'll use the IP address that we got from the previous query. When I did it, I got 209 dot 132 dot 183 dot 105. So to do a reverse query we'll do "dig space dash x space 209 dot 132 dot 183 dot 105 space plus short" and hit enter. This shows us the DNS name associated with this IP address, using the short form. Another common task is to query a specific DNS server. In the default output it shows us the DNS server that responded, which may not be the one we want to query. To specify a DNS server, precede it's IP or name with an at symbol. Type in "dig space at ns dot one dot red hat dot com space red hat dot com". This will query the ns one dot red hat dot com DNS server for the address record for red hat dot com, and enter. This is most useful when querying our own DNS servers to verify that they're giving the answers that we want. You can also do bulk DNS name queries by making a text file with each DNS name in it on a separate line. For instance, let's make a file named "DNS names dot txt" in our home directory using vi. Type in "clear" and then type in "vi space DNS names dot txt" and hit enter. In this file we're going to add three lines by pressing the "i" key to go into insert mode and then we're going to type in "red hat dot com", enter, "ford dot com", enter, and "centos dot com" and we'll hit enter again. Save and exit by pressing escape, colon, x, enter. To use this file we'll pass the dash F option to dig and specify the file name. Because we're getting back answers from multiple sites, we'll probably want to add the "plus no all" and "plus answer" options as well. So type in "dig space dash F space DNS names dot txt space plus no all space plus answer" and hit enter. We can specify the type of record as well, like we did earlier. If you find yourself typing in the same options to dig every single time, you can store them in a file called "dot digrc" in your home directory. In this file, just add the options such as "plus no all space plus answer" on one line, and they will be automatically appended when using dig, unless you override them.in man nslookup and hit Enter.

### How name resolution works

- [Instructor] I won't spend too much time on how DNS name resolution works as that is a topic I will assume you know. However, just to make sure terminology we cover later makes sense, I'll skim it. DNS name space is a hierarchy. At the top is dot, which is the root of the tree. The levels right below it are the top level domains or TLDs, examples would be com, net, or org. Below the TLD is a domain which is a collection of hosts. An example of a domain would be redhat.com. Below the domain will be sub-domains such as access.redhat.com. These domains can then be sub-divided farther depending on the needs of the organization. Deep within the organization would be the hosts, which have host names. For instance, if we had a server called rhhost1 in the access.redhat.com sub-domain. It's fully qualified domain name, or FQDN would be rhhost1.access.redhat.com. What is more important for us is that sections of a company's DNS tree can be divided up and given to one DNS server or another to manage. These sections don't have to correlate exactly to sub-domains and domains either. One DNS server could manage different portions depending on how the network is configured. For instance, DNS server one could manage the host and access.redhat.com and DNS server two could manage resolving the host directly under redhat.com. DNS names inside of an organization can be managed by the DNS administrators themselves. But if that host has to be accessed from the internet by its DNS name, it needs to be registered with a domain registrar. This lets the rest of the world know who manages the resolution for that particular name. Not anyone can be a registrar, as they are licensed by ICANN or Internet Corporation for Assigning Names and Numbers. I mentioned that at the top of the tree are the root servers designated by the dot. There are not many of these servers running, but they do have mirrors to share the load. We can see where they are by looking at a file included in the binder package. The file /var/named/named.ca. This lists both their IP version four addresses as well as IP version six addresses. It's important to note that the root servers only handle queries for the top-level domains. If you try to resolve access.redhat.com, the root server will tell you which DNS server to follow up with that manages that domain. The rest of the resolution process goes through other DNS servers. If the roots servers handled all DNS queries, they'd be overloaded in the first second of operation.stst

### DNS roles

- [Narrator] In DNS, there are several roles for hosts which interact with it. These include, primary DNS server, secondary DNS server, caching-only DNS server, forwarding DNS server and lastly DNS client. We'll quickly go over them now. A primary DNS server or master server has control over its domains and/or subdomains. Each domain has to have a primary DNS server. It may also have other types of servers as well which we'll talk about in a moment. On the primary DNS server is a collection of zone files. A zone file describes the domains and/or subdomains that the primary DNS server manages. Changes to the zone files will only be done on the primary DNS server. A secondary DNS server or slave server also have authority over its domains and holds copies of the zone files. These are copied over from the primary DNS server. Any changes to the zone files are done on the primary DNS server and the changes propagate automatically. A third type of DNS server is caching-only server. A caching-only server does not hold any zone files and has no authority over its domains. And only caches results or queries by clients. It's job to relieve the primary and secondary servers from having to answer queries. A fourth type of DNS server is the forwarding DNS server. It's only job is to forward queries onto other DNS servers. Those servers could be primary, secondary or caching-only servers. The last role in DNS is the client which queries the DNS server to resolve DNS names to IP addresses.

### Installing BIND and DNS tools

Selecting transcript lines in this section will navigate to timestamp in the video

- [Instructor] For this exercise, we'll need to be logged into our rhhost1 VM and have a terminal open. We'll install both a bind-server package and a bind-utilities package if we don't have them already. Type in sudo yum install -y bind bind-utils and hit enter. Type in your password if prompted. Once those are installed let's take a look. Type in clear and then type in yum list installed | grep caret bind and hit enter. And this shows the bind package and some of its dependencies. Now let's enable and start the service. Type in clear again and type in sudo systemctl enable named and hit enter. And then start the service by bringing a line back and changing enabled to start. And hit enter again.
